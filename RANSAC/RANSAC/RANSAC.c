#include <stdio.h>
#include <stdlib.h>
#include <math.h>

typedef struct Point 
{
    double x;
    double y;
} Point;

// 用于计算两点之间的距离
double distance(Point p1, Point p2) 
{
    return sqrt((p1.x - p2.x) * (p1.x - p2.x) + (p1.y - p2.y) * (p1.y - p2.y));
}

// 用于拟合直线的函数
void fitLine(const Point* data, int number, double* bestParameter1, double* bestParameter2) 
{
    int iter = 100;
    double sigma = 1.0;
    int pretotal = 0;

    for (int i = 0; i < iter; ++i) {
        int idx1 = rand() % number;
        int idx2 = rand() % number;
        const Point* p1 = &data[idx1];
        const Point* p2 = &data[idx2];

        // 拟合直线方程 y = kx + b
        double k = (p1->y - p2->y) / (p1->x - p2->x);
        double b = p1->y - k * p1->x;

        int total = 0;
        for (int j = 0; j < number; ++j) {
            double d = fabs(data[j].y - k * data[j].x - b);
            if (d < sigma) {
                total++;
            }
        }

        if (total > pretotal) {
            pretotal = total;
            *bestParameter1 = k;
            *bestParameter2 = b;
        }
    }
}

int main() 
{

    double x[] = { 118.000000	,262.501009	,255.962623	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,-0.000000	,-0.000000	,-0.000000	,-0.000000	,-0.000000	,-0.000000	,-137.967577	,-138.970702	,-203.147567	,-240.484296	,-0.000000	,-0.000000	,-0.000000	,-0.000000	,-0.000000	,-263.867045	,-0.000000	,-295.552773	,-296.624876	,-295.961842	,-0.000000	,-0.000000	,-145.168036	,-135.438857	,-127.655162	,-126.897327	,-125.542322	,-115.737842	,-107.416150	,-107.760247	,-100.698518	,-94.802803	,-90.590216	,-87.844134	,-78.018680	,-76.593426	,-72.448499	,-72.085109	,-65.643831	,-54.600565	,-53.185701	,-57.379043	,-42.208119	,-35.964461	,-37.148944	,-37.148944	,-28.133879	,-24.231702	,-21.046792	,-17.308535	,-9.124283	,-8.255639	,-7.690966	,2.120898	,7.370653	,5.258978	,6.465706	,14.777774	,21.226833	,22.858460	,27.404300	,35.314682	,33.828989	,35.500496	,42.083992	,48.321722	,49.713705	,52.276642	,62.341506	,63.438966	,66.920142	,69.925549	,76.113361	,81.840621	,82.430496	,83.945050	,93.913140	,98.404601	,99.623452	,104.547972	,110.725985	,112.789661	,114.877980	,124.071565	,128.894161	,131.672886	,131.868217	,145.112173	,144.525940	,151.382095	,149.906591	,163.735202	,165.354202	,170.440726	,173.319699	,186.856590	,189.234222	,189.314925	,268.372348 };
    double y[] = { 0.000000	,16.193213	,72.381873	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,99.322443	,99.640072	,138.733795	,145.355783	,0.000000	,0.000000	,0.000000	,0.000000	,0.000000	,24.478206	,0.000000	,16.265253	,14.922562	,4.752676	,-0.000000	,-0.000000	,-262.538076	,-262.071204	,-257.046999	,-256.306591	,-258.085500	,-258.251335	,-256.409381	,-253.007370	,-255.899997	,-256.010602	,-253.287214	,-254.252646	,-255.346991	,-253.689667	,-252.824475	,-251.888343	,-253.643229	,-253.179340	,-253.480337	,-251.538557	,-252.496485	,-251.440962	,-251.268693	,-251.268693	,-250.424609	,-249.827590	,-250.116038	,-249.400109	,-248.832770	,-248.863104	,-248.881195	,-247.990931	,-246.890003	,-246.944008	,-246.915359	,-246.557534	,-246.086208	,-245.940015	,-245.475059	,-244.462417	,-245.681907	,-245.445951	,-244.403227	,-244.266271	,-245.007240	,-244.473215	,-242.102327	,-242.850772	,-242.952042	,-242.104146	,-240.230631	,-241.510068	,-241.309373	,-240.786687	,-237.076617	,-239.577825	,-240.156549	,-238.054031	,-237.452640	,-239.798858	,-238.805464	,-236.421756	,-238.384763	,-236.861249	,-237.896560	,-231.238961	,-236.307538	,-234.359684	,-235.306213	,-230.824140	,-234.578320	,-233.390143	,-231.260204	,-223.082081	,-227.610213	,-228.842433	,-131.822923};
    
    //写入data
    int size = sizeof(y) / sizeof(y[0]);

    Point data[400] = { 0 };
    for (int i = 0; i < size; i++)
    {
		data[i].x=x[i];
		data[i].y=y[i];
	}


    /*Point data[] =
    {
        {1, 2},
        {2, 4},
        {3, 6},
        {4, 8},
        {5, 10}
    };*/
    int number = size;

    // 绘制数据点
    for (int i = 0; i < number; ++i) 
    {
        printf("x: %f, y: %f\n", data[i].x, data[i].y);
    }

    // 拟合直线
    double bestParameter1 = 0.0;
    double bestParameter2 = 0.0;
    fitLine(data, number, &bestParameter1, &bestParameter2);

    // 绘制最佳匹配曲线
    printf("Best Line: y = %fx + %f\n", bestParameter1, bestParameter2);

    return 0;
}

